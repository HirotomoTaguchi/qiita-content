---
title: デバイスコードフローを悪用して Microsoft 365 のアカウントを侵害するフィッシングキャンペーンが増えているらしいので軽くまとめる
tags:
  - 'Security'
  - 'Microsoft Security'
  - 'SIEM & XDR'
  - 'Entra ID'
private: false
updated_at: ''
id: null
organization_url_name: null
slide: false
ignorePublish: false
---

2024年ぐらいに流行っていたデバイスコードを悪用したフィッシング攻撃がまた増えているという話を小耳にはさみました。決して新しい攻撃手法とかではないですが、改めて対策等をまとめておきます。

:::note alert
本記事はあくまでメモです。対策についてのコメントを付記しているケースもありますが、いかなる網羅性や完全性も保証いたしかねます。
:::

## デバイスコードフローとは？

### デバイスコードフローが生まれた背景

仕組みを説明する前にこれが生まれた経緯から。Webブラウザを搭載していないデバイスや文字入力が困難なデバイスが、ユーザーの承認を通じてアクセストークンを取得するためのサインインフローです。[^1]。それらのデバイスをセットアップする時、キーボード入力を行うことは難しいので、画面に表示されたコードを別のデバイス（スマホやPCなど）で入力することでサインインを完了できる仕組みです。

### サインインの流れ

通常のデバイスコードフローは以下のように動作します。

1. デバイスが認証を要求し、短いコード（例「ABCD-1234」）を生成
2. ユーザーはスマホやPCで `https://microsoft.com/devicelogin` にアクセス
3. 表示されたコードを入力
4. 本人確認（通常はMFAを含む）を完了
5. 元のデバイスが自動的にログイン完了

